---
title: 'ì„¸ì…˜, ì¿ í‚¤, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì•Œì•„ë³´ê¸°'
description: >-
  ì™œ ë§¨ë‚  í—·ê°ˆë¦´ê¹Œ
author: Lois
date: 2024-01-07
categories: [Web]
tags: [Web]
pin: false
---

## Intro,

ë©´ì ‘ì—ì„œ ì„¸ì…˜, ì¿ í‚¤, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ëŒ€í•œ ì§ˆë¬¸ì„ ë°›ì•˜ëŠ”ë°, ê°œë…ì€ ì•Œê³  ìˆì—ˆì§€ë§Œ ë¡œê·¸ì¸ êµ¬í˜„ ê³¼ì • ì„¤ëª…ì— ìˆì–´ì„œ ë§ì´ ë¶€ì¡±í–ˆë‹¤. ëª‡ ë…„ì „ì— ë‹¤ë¤„ë³¸ ì ì´ ìˆì—ˆëŠ”ë°, íšŒì‚¬ ë“¤ì–´ê°€ê³  ë‚œ ì´í›„ì—ëŠ” í•œ ë²ˆë„ ë‹¤ë¤„ë³¸ ì ì´ ì—†ì–´ì„œ ê¸°ì–µì„ ë˜ì‚´ë ¤ ë‹¤ì‹œ ì •ë¦¬í•´ë³´ë ¤ í•œë‹¤. 

---

## ë“±ì¥ ë°°ê²½

ë¨¼ì € HTTPì˜ íŠ¹ì§•ì„ ì˜ ì•Œì•„ì•¼ í•œë‹¤. HTTPëŠ” ìš”ì²­ê³¼ ì‘ë‹µìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ” í•œ ì‚¬ì´í´ì´ ëë‚˜ë©´, ì—°ê²°ì´ ë°”ë¡œ ëŠì–´ì§€ëŠ” `Connectless` ì˜ íŠ¹ì§•ì„ ë„ë©°, ì´ë¡œ ì¸í•´ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ì´ì „ ìƒíƒœë¥¼ ì•Œ ìˆ˜ê°€ ì—†ëŠ” `Stateless` ì˜ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤.  ì´ ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ì˜ ìƒíƒœë¥¼ ì„œë²„ê°€ ì•„ë‹ˆë¼, í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥í•´ë‘ê³  í•„ìš” ì‹œ ì„œë²„ì— ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ HTTP ì˜ ë‹¨ì ì„ ë³´ì™„í•˜ë ¤ëŠ” ì‹œë„ê°€ ì´ë£¨ì–´ì¡Œìœ¼ë©°, ê·¸ ë°©ì•ˆìœ¼ë¡œ **â€˜ì„¸ì…˜â€™, â€˜ì¿ í‚¤â€™, â€˜ì›¹ ìŠ¤í† ë¦¬ì§€â€™**  ìˆë‹¤.

## ì„¸ì…˜, ì¿ í‚¤, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì˜ ì°¨ì´ì 

### 1) ì„¸ì…˜

- ì¼ì • ì‹œê°„ ë™ì•ˆ ë¸Œë¼ìš°ì €ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”êµ¬ ì‚¬í•­ì„ í•˜ë‚˜ì˜ â€˜ìƒíƒœâ€™ ë¡œ ë³´ê³ , ê·¸ ìƒíƒœë¥¼ ìœ ì§€ì‹œí‚¤ëŠ” ê¸°ìˆ ì´ë‹¤.
- object ê°ì²´ë¡œ ì„œë²„ì— ì €ì¥ì´ ëœë‹¤.
- ì„œë²„ì˜ ëŠ¥ë ¥ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ìš©ëŸ‰ì— ì œí•œì€ ì—†ë‹¤.
- ì„¸ì…˜ ID ëŠ” ì„œë²„ì— ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì— ë¹„êµì  ì•ˆì „í•œë‹¤.
- expires ë‚˜ max-age ì˜µì…˜ì„ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´, ë¸Œë¼ìš°ì € ë‹«ì„ ë•Œ ì¿ í‚¤ë„ í•¨ê»˜ ì‚­ì œëœë‹¤. ì´ëŸ¬í•œ ì¿ í‚¤ë¥¼ ì„¸ì…˜ ì¿ í‚¤ë¼ ë¶€ë¥¸ë‹¤.
- ì •ë³´ê°€ ì„œë²„ì— ìˆê¸° ë•Œë¬¸ì— ì²˜ë¦¬ì— ìš”êµ¬ ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— ë¹„êµì  ëŠë¦¬ë‹¤.
- ì˜ˆì‹œ) í™”ë©´ì„ ì´ë™í•´ë„ ë¡œê·¸ì¸ì´ í’€ë¦¬ì§€ ì•Šê³  ìœ ì§€í•˜ë ¤ëŠ” ê²½ìš°

### 2) ì¿ í‚¤

- 4KB ì •ë„ì˜ í´ë¼ì´ì–¸íŠ¸ ë‹¨ì— ì €ì¥í•˜ëŠ” ì‘ì€ í…ìŠ¤íŠ¸ íŒŒì¼
- íŒŒì¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì €ê°€ ì¢…ë£Œë˜ì–´ë„ ì •ë³´ëŠ” ê³„ì† ë‚¨ì•„ìˆì„ ìˆ˜ ìˆë‹¤.
- ë§Œë£Œ ê¸°ê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
- í•˜ë‚˜ì˜ ë„ë©”ì¸ ë‹¹ 20ê°œì˜ ì¿ í‚¤ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
- ì„œë²„ì— ìš”ì²­ ì‹œ ì†ë„ê°€ ë¹ ë¥´ì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ì˜ ë¸Œë¼ìš°ì € ë¡œì»¬ì— ì €ì¥ë˜ê¸° ë–„ë¬¸ì— ë³€ì§ˆë˜ê±°ë‚˜ HTTP ìš”ì²­ ì‹œ ì´ë¥¼ ê°ˆì·¨ë‹¹í•  ìˆ˜ ìˆì–´ ë³´ì•ˆì— ì·¨ì•½í•˜ë‹¤.
- ì˜ˆì‹œ) ë¡œê·¸ì¸ ì‹œ â€˜ì•„ì´ë””/íŒ¨ìŠ¤ì›Œë“œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?â€™ ì•Œë¦¼, íŒì—…ì°½ì„ í†µí•´ â€˜ì˜¤ëŠ˜ ì´ ì°½ ë³´ì§€ ì•Šê¸°â€™ ì²´í¬

### 3) ë¡œì»¬ ìŠ¤í† ë¦¬ì§€

- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì™€ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ê°€ ì¡´ì¬í•œë‹¤.
- key-valueì˜ í˜ì–´ë¡œ ì €ì¥ì´ ë˜ë©°, window í”„ë¡œí¼í‹°ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.
- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ëŠ” ì‚¬ìš©ìê°€ ì‚­ì œë¥¼ í•´ì£¼ì§€ ì•ŠëŠ” í•œ ë°ì´í„°ì˜ ì˜êµ¬ì ì¸ ì €ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.  ë°˜ë©´, ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ëŠ” ë¸Œë¼ìš°ì €ì˜ íƒ­ì´ ë‹«íˆë©´ ì´ˆê¸°í™”ê°€ ëœë‹¤.

## ì„œë²„ ì‚¬ì´ë“œì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ì–»ì„ ìˆ˜ ìˆì„ê¹Œìš”?

ë¡œê·¸ì¸ì˜ ê²½ìš°ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¨¼ì € íŠ¹ì • ê°’ì„ ë³´ë‚´ë©´ ì„œë²„ì—ì„œ ì„¸ì…˜ ì•„ì´ë””ë¥¼ ìƒì„±í•´ì„œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì— ì €ì¥ì´ ë˜ëŠ” ë°©ì‹ì¸ë°, ê·¸ë ‡ë‹¤ë©´ ë°˜ëŒ€ë¡œ, ì„œë²„ ì‚¬ì´ë“œì—ì„œ ë¨¼ì € ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ ê°’ì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì„ ì—¬ì­¤ë³´ì…¨ë˜ ê²ƒ ê°™ë‹¤.

ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ë¸Œë¼ìš°ì €ëŠ” í•´ë‹¹ ë„ë©”ì¸ì— ì†í•œ ì¿ í‚¤ ì •ë³´ë¥¼ ìš”ì²­ê³¼ í•¨ê»˜ ì„œë²„ë¡œ ì „ë‹¬í•˜ê²Œ ëœë‹¤. ì´ ì¿ í‚¤ ì •ë³´ëŠ” ìš”ì²­ í—¤ë”ì— í¬í•¨ë˜ì–´ ì„œë²„ë¡œ ì „ì†¡ì´ ëœë‹¤. ì´ ê°’ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´, Express í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•˜ë©´, app.get(â€™/â€™) ì„ listen í•˜ê³  ìˆëŠ” ë‹¤ìŒ ê·¸ ê²½ë¡œë¡œ ë¸Œë¼ìš°ì € ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ ìš”ì²­ í—¤ë” ì†ì„±ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤. ì¿ í‚¤ëŠ” ì´ í—¤ë” ì¤‘ì—ì„œ â€˜cookieâ€™, ë˜ëŠ” â€˜set-cookieâ€™ ë¼ëŠ” ì†ì„±ì— í¬í•¨ì´ ëœë‹¤. 

```tsx
const express = require('express');
const app = express();

app.get('/', (req, res) => {
    // í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ ê°’ì„ ê°€ì ¸ì˜´
    const cookies = req.headers.cookie;
    // cookies ë³€ìˆ˜ì— í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ ê°’ë“¤ì´ ë¬¸ìì—´ í˜•íƒœë¡œ ë“¤ì–´ìˆìŒ
    console.log(cookies);

    // ì´í›„ ì¿ í‚¤ ê°’ì„ íŒŒì‹±í•˜ì—¬ í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ
    // ...

    res.send('Hello World');
});
```

next 13 ë²„ì „ì—ì„œëŠ” â€˜next/headersâ€™ ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤. 

```tsx
import { cookies } from 'next/headers'
 
export default function Page() {
  const cookieStore = cookies()
  const theme = cookieStore.get('theme')
  return '...'
}
```

next 12 ë²„ì „ì—ì„œëŠ” getServereSideProps ì˜ req.headers ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤. 

```tsx
export async function getServerSideProps(context) {
  const cookies = context.req.headers.cookie;
  return {
    props: {},
  };
}
```

Next.js ì˜ ì„œë²„ ì‚¬ì´ë“œì—ì„œëŠ” ë”°ë¡œ ë¸Œë¼ìš°ì €ì— ìš”ì²­ì„ listen ì•Šê³  cookie ê°’ì„ ì–»ì„ ìˆ˜ ìˆëŠ”ë° ì´ë ‡ê²Œ í•  ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ? Docs ë¥¼ ì ê¹ ì‚´í´ë³´ì.

> TheÂ `req`Â in the context passed toÂ `getServerSideProps`Â provides built in middleware that parses the incoming request (`req`). That middleware is: `req.cookies`Â - An object containing the cookies sent by the request. Defaults toÂ `{}`
> 

ìš°ì„ , **getServerSideProps ì˜ req ê°’ì€ Next.js ì˜ middleware ì—ì„œ req.cookies ë¥¼ íŒŒì‹±í•œ ê°’**ì´ë‹¤. ë¯¸ë“¤ì›¨ì–´ëŠ” ìœ ì €ê°€ ë³´ë‚¸ ìš”ì²­ê³¼ ì‘ë‹µ ì‚¬ì´í´ ë„ì¤‘ì— ì¤‘ê°„ì˜ ëª©ì ì— ë§ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ê±°ì³ê°€ëŠ” ì¥ì†Œë¡œ ë³´ë©´ ëœë‹¤.

> Middleware runs before cached content, so you can personalize static files and pages. Common examples of Middleware would be authentication, A/B testing, localized pages, bot protection, and more. Regarding localized pages, you can start with i18n routing and implement Middleware for more advanced use cases.
> 

 Next.js ì˜ ë¯¸ë“¤ì›¨ì–´ëŠ” ìºì‹œëœ í˜ì´ì§€ë³´ë‹¤ ë¨¼ì € ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì— ì •ì  íŒŒì¼ë‚˜ í˜ì´ì§€ë¥¼ ê°œì¸í™”í•  ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ authentication, A/B í…ŒìŠ¤íŠ¸, ë¡œì»¬ë¼ì´ì¦ˆ í˜ì´ì§€, bot protection ë“±ì— ì‚¬ìš©ëœë‹¤.

![nextjs-middleware](/assets/img/articles/2024-01-07-session-cookie-storage/nextjs-middleware.png)

ì•„, ê°„ë‹¨í•œ ë°©ë²•ì´ì—ˆëŠ”ë°, ë‹¹ì‹œì— ì§ˆë¬¸ ë°›ì•˜ì„ ë•ŒëŠ” ê¸°ì–µì´ ì˜ ì•ˆë‚¬ë‹¤. ì—‰ëš±í•˜ê²Œ ë¯¸ë“¤ì›¨ì–´ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ê³  ë§ì”€ì„ ë“œë ¸ëŠ”ë°, ì˜ˆì „ì— íšŒì‚¬ ì½”ë“œì—ì„œ auth ë¥¼ ë¯¸ë“¤ì›¨ì–´ë¡œ ì²˜ë¦¬í–ˆë˜ ê¸°ì–µì´ ë‚˜ì„œ ê·¸ë¬ë˜ ê²ƒ ê°™ë‹¤.  ì•„ë¬´íŠ¼, ê¸°ì–µí•˜ì. ì„œë²„ ì‚¬ì´ë“œì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ ê°’ì€ ìš”ì²­ í—¤ë”ì˜ ì¿ í‚¤ ê°’ì„ í†µí•´ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤. 

## ê°„ë‹¨í•œ ë¡œê·¸ì¸ êµ¬í˜„í•˜ê¸°

ì´ë¡  ë§Œì„ ì•Œê¸° ë³´ë‹¤ëŠ”, ì‹¤ì „ì„ í†µí•´ ìŠµë“í•˜ë©´ ì˜¤ë˜ ê¸°ì–µí•  ìˆ˜ ìˆë‹¤. ê°„ë‹¨í•œ ë¡œê·¸ì¸ êµ¬í˜„ì„ í†µí•´ ì„¸ì…˜, ì¿ í‚¤ë¥¼ í™œìš©í•´ë³´ì. ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

1) ìœ ì €ê°€ id ì™€ pw ë¥¼ ì„œë²„ì— ì „ë‹¬í•œë‹¤.

2) ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ í—¤ë” í•„ë“œì¸ â€˜cookieâ€™ ë¥¼ í™•ì¸í•˜ì—¬, í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ì„¸ì…˜ ID ë¥¼ ë³´ëƒˆëŠ”ì§€ í™•ì¸í•¨

3) ì„¸ì…˜ ID ê°€ ì—†ë‹¤ë©´, ì„œë²„ëŠ” ì„¸ì…˜ ID ë¥¼ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡í•¨

4) í´ë¼ì´ì–¸íŠ¸ëŠ” ì¬ë¡œê·¸ì¸ ì‹œ, ì„¸ì…˜ IDê°€ ì €ì¥ëœ ì¿ í‚¤ë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ì— ì„¸ì…˜ IDë¥¼ ì „ë‹¬í•¨

5) ë¡œê·¸ì•„ì›ƒ ì‹œ, ì„œë²„ëŠ” ì„¸ì…˜IDë¥¼ ì‚­ì œí•¨.

ë°±ì—”ë“œëŠ” express ì™€ í´ë¼ì´ì–¸íŠ¸ëŠ” React ë¥¼ ì‚¬ìš©í•˜ê³ , ë°±ì—”ë“œì˜ server.js ëŠ” ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.

```tsx
const express = require("express");
const cors = require("cors");
const cookieParser = require("cookie-parser");
const session = require("express-session");
const fileStore = require("session-file-store")(session); // session file store

const app = express();

app.use(express.json());

app.use(
  cors({
    origin: "http://localhost:3000",
    credentials: true,
    allowedHeaders: [
      "set-cookie",
      "Content-Type",
      "Access-Control-Allow-Origin",
      "Access-Control-Allow-Credentials",
    ],
  })
);

app.use(cookieParser("secret"));

app.use(
  session({
    secret: "secret",
    resave: false,
    saveUninitialized: true,
    cookie: {
      domain: "localhost",
      path: "/",
      maxAge: 24 * 6 * 60 * 10000,
      httpOnly: false,
      secure: false, // test for localhost
    },
    name: "session-cookie",
    store: new fileStore(),
  })
);

app.get("/autoLogin", (req, res, next) => {
  // ì„¸ì…˜ IDê°€ í¬í•¨ì´ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
  if (req.session.user) {
    return res.sendStatus(200);
  } else {
    return res.sendStatus(401);
  }
});

app.post("/login", (req, res) => {
  const id = req.body.id;

  // ë¡œê·¸ì¸ ë¡œì§ ìˆ˜í–‰ í›„ ì‚¬ìš©ì ì •ë³´ë¥¼ ì„¸ì…˜ì— ì €ì¥
  // ë§Œì•½ ì„¸ì…˜ì´ ì—†ë‹¤ë©´, ì„¸ì…˜ ë“±ë¡
  if (typeof req.session.user === "undefined") {
    req.session.user = id;
  }

    req.session.save(function () {
      res.status(200).send(`Login Success`);
    });
});

app.get("/logout", (req, res) => {
  // ì„¸ì…˜ ë°ì´í„° ì‚­ì œ (ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬)
  req.session.destroy((err) => {
    if (err) {
      console.error("Error destroying session:", err);
      res.status(500).send("Internal Server Error");
    } else {
      // í´ë¼ì´ì–¸íŠ¸ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì„¸ì…˜ ì¿ í‚¤ ì‚­ì œ
      res.send("Logged out successfully!");
    }
  });
});

app.listen(8000, () => console.log("Backend Running on Port 8000"));
```

ìœ„ ì½”ë“œë¥¼ í•˜ë‚˜ì”© ëœ¯ì–´ë³´ì.

**1) Express App ì„¤ì •**

```tsx
app.use(
  cors({
    origin: "http://localhost:3000",
    credentials: true,
    allowedHeaders: [
      "set-cookie",
      "Content-Type",
      "Access-Control-Allow-Origin",
      "Access-Control-Allow-Credentials",
    ],
  })
);
```

- Origin: `Access-Control-Allow-Origin` **ë¡œ,** í†µì‹ ì„ í—ˆìš©í•œ ì£¼ì†Œë¥¼ ëª…ì‹œí•œë‹¤.
- credentials: `Access-Control-Allow-Credentials` ë¡œ, ì¸ì¦ ì •ë³´ë¥¼ ë‹´ì•„ì„œ ë³´ë‚¼ì§€ ê²°ì •í•˜ëŠ” í•­ëª©ì´ë‹¤. ë§Œì•½ ì¿ í‚¤ ê°™ì€ ì¸ì¦ í—¤ë” ì •ë³´ë¥¼ í¬í•¨í•œë‹¤ë©´ â€˜trueâ€™ ë¡œ ì„¤ì •í•œë‹¤.
- allowedHeaders: `Access-Control-Allow-Headers` ë¡œ, í—¤ë”ê°€ ì–´ë–¤ ì‹ìœ¼ë¡œ êµ¬ì„±ë ì§€ ì„¤ì •í•œë‹¤.
    - set-cookie: ì„œë²„ê°€ ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ” set-cookie ë¼ëŠ” ì‘ë‹µ í—¤ë”ì— ì¿ í‚¤ ì •ë³´ë¥¼ ëª…ì‹œí•œë‹¤.

```tsx
app.use(cookieParser("secret"));

app.use(
  session({
    secret: "secret",
    resave: false,
    saveUninitialized: false,
    cookie: {
      domain: "localhost",
      path: "/",
      maxAge: 24 * 6 * 60 * 10000,
      httpOnly: false, // test for localhost
      secure: false, // test for localhost
    },
    name: "session-cookie",
    store: new fileStore(),
  })
);
```

- `cookieParser`: ìš”ì²­ê³¼ í•¨ê»˜ ë“¤ì–´ì˜¨ ì¿ í‚¤ë¥¼ í•´ì„í•˜ì—¬ ë°”ë¡œ req.cookies ê°ì²´ë¡œ ìƒì„±í•œë‹¤.
- `session`: express-sessionì€ express ì—ì„œ ì„¸ì…˜ ê°’ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
    - secret: ì•”í˜¸í™”ë¥¼ ìœ„í•œ í‚¤ ê°’
    - resave (default true): true ë¼ë©´ ì„¸ì…˜ì´ ë³€ê²½ ì‚¬í•­ì´ ì—†ë”ë¼ë„ í•­ìƒ ìƒˆë¡­ê²Œ ì €ì¥ë¨
    - saveUninitialized (default true): ì„¸ì…˜ì´ ìƒì„±ë˜ì—ˆì§€ë§Œ ë³€ê²½ ì‚¬í•­ì´ ì—†ëŠ” ìƒíƒœëŠ” uninitialized ë¼ê³  í•˜ë©°, true ë¼ë©´  uninitialized ë„ ì €ì¥í•˜ê²Œ ëœë‹¤. false ë¡œ ì„¤ì •í•˜ë©´ ì €ì¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ í™œìš© ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•˜ë‹¤.
    - cookie: Session ID ë¥¼ ì €ì¥í•  ì¿ í‚¤ì— ëŒ€í•œ ì„¤ì •ìœ¼ë¡œ localhost í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œëŠ” secure ê³¼ httpOnly ë¥¼ ì„ false ë¡œ, domain ì„ localhost ë¡œ ì„¤ì •í•œë‹¤.
    - name: ì„¸ì…˜ id ë¥¼ ì €ì¥í•  ì´ë¦„
    - store: ë³´í†µ redisë¥¼ ì´ìš©í•˜ì—¬ ì„¸ì…˜ ê°’ì„ DBì— ì €ì¥í•˜ì§€ë§Œ, ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ì´ê¸° ë•Œë¬¸ì— ë¡œì»¬ file store ë¥¼ ì‚¬ìš©í–ˆë‹¤. ì„¸ì…˜ì´ ì—…ë°ì´íŠ¸ë  ë•Œë§ˆë‹¤ ì„¸ì…˜ file ì´ ë³€ê²½ë  ê²ƒì´ë‹¤.

**2) Login ì²˜ë¦¬**

```tsx
app.post("/login", (req, res) => {
  const id = req.body.id;

  // ë¡œê·¸ì¸ ë¡œì§ ìˆ˜í–‰ í›„ ì‚¬ìš©ì ì •ë³´ë¥¼ ì„¸ì…˜ì— ì €ì¥
  // ë§Œì•½ ì„¸ì…˜ì´ ì—†ë‹¤ë©´, ì„¸ì…˜ ë“±ë¡
  if (typeof req.session.user === "undefined") {
    req.session.user = id;
  }

    req.session.save(function () {
      res.status(200).send(`Login Success`);
    });
});

```

- í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° login ìš”ì²­ì„ ë°›ìœ¼ë©´, id ì™€ password ë¥¼ body ë¡œë¶€í„° ì–»ì–´ì˜¨ë‹¤.
- ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ì˜ ì„¸ì…˜ì— ìœ ì € ì •ë³´ê°€ ì—†ë‹¤ë©´ ìƒˆë¡­ê²Œ ì„¸ì…˜ì„ ë“±ë¡í•œë‹¤.
- ì„¸ì…˜ì´ ìˆë‹¤ë©´ ì•„ì§ ë§Œë£Œë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ì´ ì´ë£¨ì–´ì§„ë‹¤.

**3) ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬**

```tsx
app.get("/autoLogin", (req, res, next) => {
  // ì„¸ì…˜ IDê°€ í¬í•¨ì´ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
  if (req.session.user) {
    return res.sendStatus(200);
  } else {
    return res.sendStatus(401);
  }
});
```

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ autoLogin ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.
- ì„œë²„ì—ì„œëŠ” ìš”ì²­ í—¤ë”ì— ë‹´ê¸´ ì¿ í‚¤ ê°’ì„ í†µí•´ ì¿ í‚¤ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**4) ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬**

```tsx
app.get("/logout", (req, res) => {
  // ì„¸ì…˜ ë°ì´í„° ì‚­ì œ (ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬)
  req.session.destroy((err) => {
    if (err) {
      console.error("Error destroying session:", err);
      res.status(500).send("Internal Server Error");
    } else {
      // í´ë¼ì´ì–¸íŠ¸ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì„¸ì…˜ ì¿ í‚¤ ì‚­ì œ
      res.send("Logged out successfully!");
    }
  });
});
```

- `req.session.destory`: ì„œë²„ì˜ ì„¸ì…˜ ë°ì´í„°ë¥¼ ì—†ì• ê³ , í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ì— ë‹´ê¸´ ì„¸ì…˜ì„ ì—…ë°ì´íŠ¸í•œë‹¤. ì„¸ì…˜ ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— login ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš”ì²­ì„ ë³´ë‚´ë„ í™•ì¸í•˜ì§€ ëª»í•œë‹¤.

ì´ì œ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì. chrome > application > ì¢Œì¸¡ Cookies ë¥¼ í†µí•´ ì¿ í‚¤ ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 

ë¨¼ì € ë¡œê·¸ì¸ì„ í•˜ë©´, ì„œë²„ì—ì„œ ìƒˆë¡œìš´ ì„¸ì…˜ ID ë¥¼ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•˜ê²Œ ëœë‹¤. ìš°ë¦¬ëŠ” 1ì¼ë¡œ expires ë¥¼ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— ì˜¤ëŠ˜(30ì¼) ì—ì„œ ë‚´ì¼(31ì¼)ê¹Œì§€ ìœ íš¨í•˜ë‹¤.

![session-cookie](/assets/img/articles/2024-01-07-session-cookie-storage/session-cookie.png);

í•˜ë‹¨ì˜ â€˜Cookie Valueâ€™ íŒ¨ë„ì—ì„œëŠ” ê°’ì„ Decode í–ˆì„ ë•Œ ê²°ê³¼ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤. ë¬¸ìì—´ì€ ì„œë²„ì˜ ë¡œì»¬ íŒŒì¼ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ì„¸ì…˜ íŒŒì¼ì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ë©°, í•´ë‹¹ ì„¸ì…˜ íŒŒì¼ì„ ì—´ì–´ë³´ë©´ ìœ ì € ê°’ì´ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 

![session-cookie-2](/assets/img/articles/2024-01-07-session-cookie-storage/session-cookie-2.png);

---

## ì°¸ê³  ìë£Œ
- [node.js express 5. middlewareë€? ë¯¸ë“¤ì›¨ì–´ ì •ì˜, ë¯¸ë“¤ì›¨ì–´ ìœ í˜•](https://psyhm.tistory.com/8)
- [https://velog.io/@pds0309/nextjs-ë¯¸ë“¤ì›¨ì–´ë€](https://velog.io/@pds0309/nextjs-%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4%EB%9E%80)
- [https://www.daleseo.com/js-jwt/](https://www.daleseo.com/js-jwt/)
- [https://inpa.tistory.com/entry/EXPRESS-ğŸ“š-express-session-ë¯¸ë“¤ì›¨ì–´](https://inpa.tistory.com/entry/EXPRESS-%F0%9F%93%9A-express-session-%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4)
